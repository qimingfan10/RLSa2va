# è¡€ç®¡åˆ†å‰²è®­ç»ƒæƒé‡æ£€æŸ¥æŠ¥å‘Š

## ğŸ“¦ å·²ä¿å­˜çš„Checkpoint

åœ¨ `/home/ubuntu/Sa2VA/work_dirs/vessel_segmentation/` ç›®å½•ä¸‹æ‰¾åˆ°ä»¥ä¸‹è®­ç»ƒæƒé‡:

| Checkpoint | å¤§å° | è¿­ä»£æ¬¡æ•° |
|-----------|------|---------|
| `iter_8000.pth` | 2.59 GB | 8,000 |
| `iter_8500.pth` | 2.59 GB | 8,500 |
| `iter_9000.pth` | 2.59 GB | 9,000 |
| `iter_9500.pth` | 2.59 GB | 9,500 |
| **`iter_10000.pth`** | **2.59 GB** | **10,000** âœ… |

**æœ€æ–°checkpoint**: `iter_10000.pth` (æ ¹æ® `last_checkpoint` æ–‡ä»¶)

---

## ğŸ” Checkpoint è¯¦ç»†ä¿¡æ¯ (iter_10000.pth)

### åŸºæœ¬ä¿¡æ¯
- **è®­ç»ƒè¿­ä»£**: 10,000 / 12,192 (çº¦ **82%** å®Œæˆ)
- **Epoch**: 0 (å•epochè®­ç»ƒ)
- **å‚æ•°æ•°é‡**: 536ä¸ªå¯è®­ç»ƒå‚æ•°

### æ¨¡å‹æ¶æ„
- **åŸºç¡€æ¨¡å‹**: InternVL3-8B
- **å¾®è°ƒæ–¹æ³•**: LoRA (Low-Rank Adaptation)
  - LoRA rank: 64
  - LoRA alpha: 128
  - LoRA dropout: 0.1
  - å¯è®­ç»ƒæ¨¡å—: `embed_tokens`, `lm_head`, ä»¥åŠå„å±‚çš„æ³¨æ„åŠ›å’ŒMLPå±‚

### è®­ç»ƒé…ç½®
- **å†»ç»“ç»„ä»¶**:
  - âœ… è§†è§‰ç¼–ç å™¨ (frozen)
  - âŒ è¯­è¨€æ¨¡å‹ (å¯è®­ç»ƒ)
  - âŒ SAM2è§£ç å™¨ (å¯è®­ç»ƒ)

- **æŸå¤±å‡½æ•°**:
  - Cross Entropy Loss (æƒé‡: 3.0)
  - Dice Loss (æƒé‡: 1.0)
  - LLM Loss

- **ä¼˜åŒ–å™¨**: AdamW
  - å­¦ä¹ ç‡: 2e-05
  - Weight decay: 0.05

---

## ğŸ¯ æ¨ç†æµ‹è¯•è®¡åˆ’

### å½“å‰çŠ¶æ€
âš ï¸ **GPUæ˜¾å­˜å·²è¢«è®­ç»ƒè¿›ç¨‹å ç”¨** (4ä¸ªRTX 3090,æ¯ä¸ªçº¦19-23GB)

```
GPU 0: 23130 MiB / 24576 MiB (è®­ç»ƒä¸­)
GPU 1: 23330 MiB / 24576 MiB (è®­ç»ƒä¸­)
GPU 2: 18724 MiB / 24576 MiB (è®­ç»ƒä¸­)
GPU 3: 19988 MiB / 24576 MiB (è®­ç»ƒä¸­)
```

### æ¨ç†æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€: ç­‰å¾…è®­ç»ƒå®Œæˆåæ¨ç† (æ¨è)
è®­ç»ƒé¢„è®¡è¿˜éœ€çº¦ **9-10å°æ—¶** å®Œæˆ,å®Œæˆåå¯ä»¥:
1. åœæ­¢è®­ç»ƒè¿›ç¨‹é‡Šæ”¾GPU
2. ä½¿ç”¨å®Œæ•´çš„è®­ç»ƒæƒé‡ (iter_12192.pth)
3. å¯¹æ•°æ®é›†è¿›è¡Œå®Œæ•´æ¨ç†æµ‹è¯•

#### æ–¹æ¡ˆäºŒ: ä½¿ç”¨å½“å‰æƒé‡è¿›è¡ŒCPUæ¨ç†
- ä¼˜ç‚¹: å¯ç«‹å³æµ‹è¯•
- ç¼ºç‚¹: é€Ÿåº¦è¾ƒæ…¢,æ¨¡å‹æœªå®Œå…¨è®­ç»ƒå®Œæˆ

#### æ–¹æ¡ˆä¸‰: æš‚åœè®­ç»ƒè¿›è¡Œæµ‹è¯•
- æš‚åœå½“å‰è®­ç»ƒ
- ä½¿ç”¨ iter_10000.pth è¿›è¡ŒGPUæ¨ç†
- æµ‹è¯•å®Œæˆåæ¢å¤è®­ç»ƒ

---

## ğŸ“Š æ•°æ®é›†ä¿¡æ¯

**å›¾ç‰‡ç›®å½•**: `/home/ubuntu/Sa2VA/data/vessel_data/images/`
**å›¾ç‰‡æ•°é‡**: 78å¼  (JPGæ ¼å¼)

**ç¤ºä¾‹å›¾ç‰‡**:
- `Guo_Ru_Lian(0000817775)_1-2_1_04777872_frame_000040.jpg`
- `He_Gui_Sheng(0000836061)_1-3_1_0491953E_frame_000024.jpg`
- `Zhang_Sheng_Hua(0000933995)_1-4_1_05217761_frame_000073.jpg`
- ... (å…±78å¼ )

---

## ğŸ› ï¸ æ¨ç†è„šæœ¬

å·²åˆ›å»ºæ¨ç†è„šæœ¬: `/home/ubuntu/Sa2VA/inference_vessel.py`

**ä½¿ç”¨æ–¹æ³•**:
```bash
# æ¿€æ´»ç¯å¢ƒå¹¶è¿è¡Œæ¨ç†
/home/ubuntu/micromamba/envs/topo-sarl/bin/python inference_vessel.py \
  --checkpoint work_dirs/vessel_segmentation/iter_10000.pth \
  --num-images 10 \
  --output-dir inference_results_iter10000
```

**å‚æ•°è¯´æ˜**:
- `--checkpoint`: è®­ç»ƒå¥½çš„checkpointè·¯å¾„
- `--num-images`: è¦æ¨ç†çš„å›¾ç‰‡æ•°é‡ (é»˜è®¤10å¼ )
- `--output-dir`: è¾“å‡ºç›®å½•
- `--base-model`: åŸºç¡€æ¨¡å‹è·¯å¾„ (é»˜è®¤InternVL3-8B)

---

## ğŸ’¡ å»ºè®®

1. **ç»§ç»­è®­ç»ƒ**: å½“å‰è®­ç»ƒè¿›åº¦è‰¯å¥½,å»ºè®®ç­‰å¾…è®­ç»ƒå®Œæˆ (è¿˜éœ€çº¦10å°æ—¶)
2. **å®Œæ•´è¯„ä¼°**: è®­ç»ƒå®Œæˆåä½¿ç”¨æœ€ç»ˆæƒé‡å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œæ¨ç†
3. **æ€§èƒ½ç›‘æ§**: ç»§ç»­ç›‘æ§è®­ç»ƒæ—¥å¿—,ç¡®ä¿æŸå¤±ç»§ç»­æ”¶æ•›
4. **æ•°æ®ä¿®å¤**: ä¿®å¤æ•°æ®é›†ä¸­çš„æ©ç -æ–‡æœ¬ä¸åŒ¹é…é—®é¢˜ (4522ä¸ªè­¦å‘Š)

---

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

### é€‰é¡¹A: ç­‰å¾…è®­ç»ƒå®Œæˆ (æ¨è)
```bash
# ç›‘æ§è®­ç»ƒè¿›åº¦
tail -f work_dirs/vessel_segmentation/training_20251119_212648.log

# è®­ç»ƒå®Œæˆåè¿›è¡Œæ¨ç†
/home/ubuntu/micromamba/envs/topo-sarl/bin/python inference_vessel.py \
  --checkpoint work_dirs/vessel_segmentation/iter_12192.pth \
  --num-images 78 \
  --output-dir inference_results_final
```

### é€‰é¡¹B: ç«‹å³æµ‹è¯•å½“å‰æƒé‡
éœ€è¦å…ˆåœæ­¢è®­ç»ƒè¿›ç¨‹æˆ–ä½¿ç”¨CPUæ¨ç†

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-21 23:50
**è®­ç»ƒè¿›åº¦**: 10,200 / 12,192 (83.7%)
**é¢„è®¡å®Œæˆæ—¶é—´**: çº¦2025-11-22 09:30
